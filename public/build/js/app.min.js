//= ./app.module.js

/**
 * Created by krek on 01.08.17.
 */
angular
    .module('auth', []);

var app = angular
            .module('blog', ['ui.router', 'ngMessages', 'LocalStorageModule', 'ngMaterial', 'auth'])
            .run(function () {

            });
angular
    .module('blog')
    .config(function($stateProvider, $urlRouterProvider) {
        let mainState = {
                name: 'main',
                url: '/',
                component: 'blogList',
                resolve: {
                    posts: function (blogService) {
                        return blogService.getAllPosts()
                            .then(function (resp) {
                                if (resp.status === 200) {
                                    return resp.data;
                                } else {
                                    return [];
                                }
                            });
                    }
                }
            },
            auth = {
                name: 'auth',
                url: '/auth',
                component: 'auth',
            },
            // blogState = {
            //     name: 'blog',
            //     url: '/blog/{itemId}',
            //     component: 'blogItem',
            //     resolve: {
            //         post: function(BlogService, $transition$) {
            //             console.log($transition$.params().itemId);
            //             return BlogService.getPost($transition$.params().itemId);
            //         }
            //     }
            // },
            state404 = {
                name: '404',
                url: '/404',
                templateUrl: '/404.html'
            };

        $urlRouterProvider.otherwise('/');
        $stateProvider.state(mainState);
        // $stateProvider.state(blogState);
        $stateProvider.state(state404);
        $stateProvider.state(auth);

    })
angular
    .module('auth')

    .component('auth', {
        templateUrl: './js/app/auth/auth.tmpl.html',
        controller: authController,
    });

function authController($scope, authService, $state) {
    var $ctrl = this;

    $ctrl.$onInit = onInit;
    $ctrl.login = login;
    $ctrl.logout = logout;
    $ctrl.registration = registration;
    $ctrl.authMessage = '';
    $ctrl.regMessage = '';

    console.log($ctrl);

    function onInit() {
        "use strict";
        console.log(authService.status);
    }

    function login() {
        "use strict";
        var email = $ctrl.formData.authForm.email,
            password = $ctrl.formData.authForm.password;

        authService.authUser(email, password)
            .then(function() {
                $state.go('main');
            })
            .catch(function (err) {
                $ctrl.authMessage = err.data.message;
            });
    }

    function logout() {
        "use strict";
        authService.logout();
    }

    function registration() {
        "use strict";
        var email = $ctrl.formData.registrationForm.email,
            password = $ctrl.formData.registrationForm.password;

        console.log(authService.registerUser(email, password));
    }
}

angular
    .module('blog')
    .component('blogList', {
        templateUrl: './js/app/blog-list/blog-list.tmpl.html',
        controller: blogListController,
        bindings: {
            posts: '<'
        }
    });


function blogListController($scope, blogService, $mdDialog, authService, $state) {
    var $ctrl = this;


    $ctrl.showAddDialog = showAddDialog;
    $ctrl.$onInit = $onInit;
    $ctrl.deletePost = deletePost;


    function showAddDialog(env) {
        "use strict";
        $mdDialog.show({
            controller: addDialogController,
            templateUrl: './js/app/blog-list/directives/add-dialog.tmpl.html',
            targetEvent: env,
            clickOutsideToClose: true,
            locals: {
                posts: $ctrl.posts
            }

        }).then(function (result) {
            console.log(result);
        })

        function addDialogController($scope, $mdDialog, posts) {
            var $ctrl = $scope;
            $ctrl.close = close;
            $ctrl.addPost = addPost;
            $ctrl.posts = posts;

            function close() {
                "use strict";
                $mdDialog.hide();
            }

            function addPost() {
                blogService.addPost($ctrl.title, $ctrl.text)
                    .then(function (resp) {
                        console.log(resp);
                        $ctrl.posts.push(resp.data);
                        close();
                    }).catch(function (err) {
                    console.log(err);
                });
            }
        }
    }

    function $onInit() {
        "use strict";
        $ctrl.authService = authService;
        $ctrl.status = $ctrl.authService.authData;
    }

    function deletePost(id, $index) {
        "use strict";
        var confirm = $mdDialog.confirm()
            .title('Would you like to delete this article?')
            .ok('Ok')
            .cancel('Cancel');

        $mdDialog.show(confirm).then(function() {
            blogService.removePost(id);
            $ctrl.posts.splice($index, 1);
            $mdDialog.hide();
        }, function() {
            $mdDialog.hide();
        });
    };

}

angular
    .module('blog')

    .component('blogHeader', {
        templateUrl: './js/app/header/header.tmpl.html',
        controller: headerController
    });

function headerController($scope, authService) {
    let $ctrl = this;
    $ctrl.authService = authService;
    $ctrl.authData = $ctrl.authService.authData;

    $ctrl.logout = logout;


    // $scope.$watch('$ctrl.status.authorization', checkAuth);
    //
    // function checkAuth(newValue, oldValue, scope) {
    //     "use strict";
    //     if (newValue) {
    //         $ctrl.email = authService.getProfileData().email;
    //     }
    // }

    function logout () {
        "use strict";
        authService.logout();
    }
}


angular
    .module('auth')
    .directive('checkEmail', function ($http, $q) {
        "use strict";
        return {
            require: 'ngModel',
            restrict: 'A',
            link: link
        }

        function link(scope, elem, attrs, ngModel) {
            ngModel.$asyncValidators.emailExist = emailExist;


            function emailExist(modelValue, viewValue) {
                return $http.get('//localhost:3000/api/auth/check/' + viewValue)
                    .then(function (response) {
                        if (response.data.status == 200) {
                            return true;
                        } else {
                            $q.reject(response.data.status);
                        }
                    });
            }
        }
    })
angular
    .module('auth')
    .directive('pwdCheck', function() {
        "use strict";
        return {
            require: 'ngModel',
            restrict: 'A',
            scope: {
                passwordValue: '=pwdCheck'
            },
            link: link
        }

        function link (scope, element, attrs, ngModel) {
            ngModel.$validators.pwdCheck = pwdCheck;
            scope.$watch('passwordValue', watch);

            function pwdCheck(modelValue) {
                return modelValue === scope.passwordValue;
            }


            function watch() {
                ngModel.$validate();
            }
        }

    })
angular
    .module('auth')

    .service('authService', authService);


function authService($http, $q, $rootScope, localStorageService) {
    "use strict";
    var _self = this;

    _self.authData = {
        authorization: isAuth(),
        email: getProfileData() ? getProfileData().email : '',
    };

    _self.registerUser = registerUser;
    _self.authUser = authUser;
    _self.logout = logout;

    _self.setProfileData = setProfileData;
    _self.getProfileData = getProfileData;
    _self.removeProfileData = removeProfileData;

    return _self;

    function isAuth() {
        return getProfileData() ? true : false;
    }

    function registerUser(email, password) {
        var deffered = $q.defer();
        $http
            .post("//localhost:3000/api/auth/signup", {
                email: email,
                password: password
            })
            .then(function (res) {
                deffered.resolve(authUser(email, password));

            }, function (err) {
                deffered.reject(err.status);
            });

        return deffered.promise;
    };

    function authUser(email, password) {
        "use strict";
        var deffered = $q.defer();
        $http
            .post("//localhost:3000/api/auth/signin", {
                email: email,
                password: password
            })
            .then(function (res) {
                var data = {
                    token: res.data.token,
                    email: res.config.data.email
                }
                setProfileData(data);
                _self.authData.email = data.email;
                _self.authData.authorization = true;
                deffered.resolve();
            }, function (err) {
                deffered.reject(err);
            });

        return deffered.promise;
    }

    function logout() {
        "use strict";
        $http
            .post("http://localhost:3000/api/auth/logout", {}, {
                headers: {
                    'Token': getProfileData().token
                }
            })
            .then(function (res) {
                    removeProfileData();
                    _self.authData.authorization = false;
                },
                function (err) {
                    console.log(err);
                })
    }

    function setProfileData(data) {
        return localStorageService.set('blogData', data);
    }

    function getProfileData() {
        return localStorageService.get('blogData');
    }

    function removeProfileData() {
        return localStorageService.remove('blogData');
    }

}



angular
    .module('blog')
    .service('blogService', blogService);

function blogService($http, $q, authService) {
    var _self = this;

    _self.getAllPosts = getAllPosts;
    _self.getPost = getPost;
    _self.addPost = addPost;
    _self.removePost = removePost;

    function getAllPosts() {
        "use strict";
        var deffered = $q.defer();
        $http.get('//localhost:3000/api/blog')
            .then(function(resp) {
                "use strict";
                deffered.resolve(resp);
            }, function (err) {
                deffered.reject(err);
            });
        return deffered.promise;
    }

    function getPost() {

    }

    function addPost(title, text) {
        "use strict";
        var deffered = $q.defer();
        $http.post('//localhost:3000/api/blog',{
            title: title,
            text: text,
        }, {
            headers: {
                'Token': authService.getProfileData().token
            }
        }).then(function (resp) {
            deffered.resolve(resp);
        }, function (err) {
            deffered.reject(err);
        });
        return deffered.promise;
    }

    function removePost(id) {
        "use strict";
        var deffered = $q.defer();
        $http.delete('//localhost:3000/api/blog/'+id, {
            data: {},
            headers: {
                'Token': authService.getProfileData().token,
            }
        }).then(function (resp) {
            console.log(resp);
            deffered.resolve(resp);
        }, function (err) {
            deffered.reject(err);
        });
        return deffered.promise;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFwcC5tb2R1bGUuanMiLCJhcHAucm91dGVzLmpzIiwiYXV0aC9hdXRoLmNvbXBvbmVudC5qcyIsImJsb2ctbGlzdC9ibG9nLWxpc3QuY29tcG9uZW50LmpzIiwiaGVhZGVyL2hlYWRlci5jb21wb25lbnQuanMiLCJhdXRoL2RpcmVjdGl2ZXMvY2hlY2stZW1haWwuZGlyZWN0aXZlLmpzIiwiYXV0aC9kaXJlY3RpdmVzL3Bhc3N3b3JkQ2hlY2suZGlyZWN0aXZlLmpzIiwiYXV0aC9zZXJ2aWNlcy9hdXRoLnNlcnZpY2UuanMiLCJibG9nLWxpc3Qvc2VydmljZS9ibG9nLnNlcnZpY2UuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLz0gLi9hcHAubW9kdWxlLmpzXG4iLCIvKipcbiAqIENyZWF0ZWQgYnkga3JlayBvbiAwMS4wOC4xNy5cbiAqL1xuYW5ndWxhclxuICAgIC5tb2R1bGUoJ2F1dGgnLCBbXSk7XG5cbnZhciBhcHAgPSBhbmd1bGFyXG4gICAgICAgICAgICAubW9kdWxlKCdibG9nJywgWyd1aS5yb3V0ZXInLCAnbmdNZXNzYWdlcycsICdMb2NhbFN0b3JhZ2VNb2R1bGUnLCAnbmdNYXRlcmlhbCcsICdhdXRoJ10pXG4gICAgICAgICAgICAucnVuKGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgfSk7IiwiYW5ndWxhclxuICAgIC5tb2R1bGUoJ2Jsb2cnKVxuICAgIC5jb25maWcoZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xuICAgICAgICBsZXQgbWFpblN0YXRlID0ge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdtYWluJyxcbiAgICAgICAgICAgICAgICB1cmw6ICcvJyxcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdibG9nTGlzdCcsXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICBwb3N0czogZnVuY3Rpb24gKGJsb2dTZXJ2aWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYmxvZ1NlcnZpY2UuZ2V0QWxsUG9zdHMoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcC5kYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYXV0aCA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnYXV0aCcsXG4gICAgICAgICAgICAgICAgdXJsOiAnL2F1dGgnLFxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ2F1dGgnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIGJsb2dTdGF0ZSA9IHtcbiAgICAgICAgICAgIC8vICAgICBuYW1lOiAnYmxvZycsXG4gICAgICAgICAgICAvLyAgICAgdXJsOiAnL2Jsb2cve2l0ZW1JZH0nLFxuICAgICAgICAgICAgLy8gICAgIGNvbXBvbmVudDogJ2Jsb2dJdGVtJyxcbiAgICAgICAgICAgIC8vICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAvLyAgICAgICAgIHBvc3Q6IGZ1bmN0aW9uKEJsb2dTZXJ2aWNlLCAkdHJhbnNpdGlvbiQpIHtcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKCR0cmFuc2l0aW9uJC5wYXJhbXMoKS5pdGVtSWQpO1xuICAgICAgICAgICAgLy8gICAgICAgICAgICAgcmV0dXJuIEJsb2dTZXJ2aWNlLmdldFBvc3QoJHRyYW5zaXRpb24kLnBhcmFtcygpLml0ZW1JZCk7XG4gICAgICAgICAgICAvLyAgICAgICAgIH1cbiAgICAgICAgICAgIC8vICAgICB9XG4gICAgICAgICAgICAvLyB9LFxuICAgICAgICAgICAgc3RhdGU0MDQgPSB7XG4gICAgICAgICAgICAgICAgbmFtZTogJzQwNCcsXG4gICAgICAgICAgICAgICAgdXJsOiAnLzQwNCcsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvNDA0Lmh0bWwnXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy8nKTtcbiAgICAgICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUobWFpblN0YXRlKTtcbiAgICAgICAgLy8gJHN0YXRlUHJvdmlkZXIuc3RhdGUoYmxvZ1N0YXRlKTtcbiAgICAgICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoc3RhdGU0MDQpO1xuICAgICAgICAkc3RhdGVQcm92aWRlci5zdGF0ZShhdXRoKTtcblxuICAgIH0pIiwiYW5ndWxhclxuICAgIC5tb2R1bGUoJ2F1dGgnKVxuXG4gICAgLmNvbXBvbmVudCgnYXV0aCcsIHtcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcuL2pzL2FwcC9hdXRoL2F1dGgudG1wbC5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogYXV0aENvbnRyb2xsZXIsXG4gICAgfSk7XG5cbmZ1bmN0aW9uIGF1dGhDb250cm9sbGVyKCRzY29wZSwgYXV0aFNlcnZpY2UsICRzdGF0ZSkge1xuICAgIHZhciAkY3RybCA9IHRoaXM7XG5cbiAgICAkY3RybC4kb25Jbml0ID0gb25Jbml0O1xuICAgICRjdHJsLmxvZ2luID0gbG9naW47XG4gICAgJGN0cmwubG9nb3V0ID0gbG9nb3V0O1xuICAgICRjdHJsLnJlZ2lzdHJhdGlvbiA9IHJlZ2lzdHJhdGlvbjtcbiAgICAkY3RybC5hdXRoTWVzc2FnZSA9ICcnO1xuICAgICRjdHJsLnJlZ01lc3NhZ2UgPSAnJztcblxuICAgIGNvbnNvbGUubG9nKCRjdHJsKTtcblxuICAgIGZ1bmN0aW9uIG9uSW5pdCgpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIGNvbnNvbGUubG9nKGF1dGhTZXJ2aWNlLnN0YXR1cyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbG9naW4oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgZW1haWwgPSAkY3RybC5mb3JtRGF0YS5hdXRoRm9ybS5lbWFpbCxcbiAgICAgICAgICAgIHBhc3N3b3JkID0gJGN0cmwuZm9ybURhdGEuYXV0aEZvcm0ucGFzc3dvcmQ7XG5cbiAgICAgICAgYXV0aFNlcnZpY2UuYXV0aFVzZXIoZW1haWwsIHBhc3N3b3JkKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdtYWluJyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAkY3RybC5hdXRoTWVzc2FnZSA9IGVyci5kYXRhLm1lc3NhZ2U7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBsb2dvdXQoKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICBhdXRoU2VydmljZS5sb2dvdXQoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZWdpc3RyYXRpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgZW1haWwgPSAkY3RybC5mb3JtRGF0YS5yZWdpc3RyYXRpb25Gb3JtLmVtYWlsLFxuICAgICAgICAgICAgcGFzc3dvcmQgPSAkY3RybC5mb3JtRGF0YS5yZWdpc3RyYXRpb25Gb3JtLnBhc3N3b3JkO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKGF1dGhTZXJ2aWNlLnJlZ2lzdGVyVXNlcihlbWFpbCwgcGFzc3dvcmQpKTtcbiAgICB9XG59XG4iLCJhbmd1bGFyXG4gICAgLm1vZHVsZSgnYmxvZycpXG4gICAgLmNvbXBvbmVudCgnYmxvZ0xpc3QnLCB7XG4gICAgICAgIHRlbXBsYXRlVXJsOiAnLi9qcy9hcHAvYmxvZy1saXN0L2Jsb2ctbGlzdC50bXBsLmh0bWwnLFxuICAgICAgICBjb250cm9sbGVyOiBibG9nTGlzdENvbnRyb2xsZXIsXG4gICAgICAgIGJpbmRpbmdzOiB7XG4gICAgICAgICAgICBwb3N0czogJzwnXG4gICAgICAgIH1cbiAgICB9KTtcblxuXG5mdW5jdGlvbiBibG9nTGlzdENvbnRyb2xsZXIoJHNjb3BlLCBibG9nU2VydmljZSwgJG1kRGlhbG9nLCBhdXRoU2VydmljZSwgJHN0YXRlKSB7XG4gICAgdmFyICRjdHJsID0gdGhpcztcblxuXG4gICAgJGN0cmwuc2hvd0FkZERpYWxvZyA9IHNob3dBZGREaWFsb2c7XG4gICAgJGN0cmwuJG9uSW5pdCA9ICRvbkluaXQ7XG4gICAgJGN0cmwuZGVsZXRlUG9zdCA9IGRlbGV0ZVBvc3Q7XG5cblxuICAgIGZ1bmN0aW9uIHNob3dBZGREaWFsb2coZW52KSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICAkbWREaWFsb2cuc2hvdyh7XG4gICAgICAgICAgICBjb250cm9sbGVyOiBhZGREaWFsb2dDb250cm9sbGVyLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcuL2pzL2FwcC9ibG9nLWxpc3QvZGlyZWN0aXZlcy9hZGQtZGlhbG9nLnRtcGwuaHRtbCcsXG4gICAgICAgICAgICB0YXJnZXRFdmVudDogZW52LFxuICAgICAgICAgICAgY2xpY2tPdXRzaWRlVG9DbG9zZTogdHJ1ZSxcbiAgICAgICAgICAgIGxvY2Fsczoge1xuICAgICAgICAgICAgICAgIHBvc3RzOiAkY3RybC5wb3N0c1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcbiAgICAgICAgfSlcblxuICAgICAgICBmdW5jdGlvbiBhZGREaWFsb2dDb250cm9sbGVyKCRzY29wZSwgJG1kRGlhbG9nLCBwb3N0cykge1xuICAgICAgICAgICAgdmFyICRjdHJsID0gJHNjb3BlO1xuICAgICAgICAgICAgJGN0cmwuY2xvc2UgPSBjbG9zZTtcbiAgICAgICAgICAgICRjdHJsLmFkZFBvc3QgPSBhZGRQb3N0O1xuICAgICAgICAgICAgJGN0cmwucG9zdHMgPSBwb3N0cztcblxuICAgICAgICAgICAgZnVuY3Rpb24gY2xvc2UoKSB7XG4gICAgICAgICAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgICAgICAgICAgJG1kRGlhbG9nLmhpZGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gYWRkUG9zdCgpIHtcbiAgICAgICAgICAgICAgICBibG9nU2VydmljZS5hZGRQb3N0KCRjdHJsLnRpdGxlLCAkY3RybC50ZXh0KVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkY3RybC5wb3N0cy5wdXNoKHJlc3AuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiAkb25Jbml0KCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgJGN0cmwuYXV0aFNlcnZpY2UgPSBhdXRoU2VydmljZTtcbiAgICAgICAgJGN0cmwuc3RhdHVzID0gJGN0cmwuYXV0aFNlcnZpY2UuYXV0aERhdGE7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGVsZXRlUG9zdChpZCwgJGluZGV4KSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgY29uZmlybSA9ICRtZERpYWxvZy5jb25maXJtKClcbiAgICAgICAgICAgIC50aXRsZSgnV291bGQgeW91IGxpa2UgdG8gZGVsZXRlIHRoaXMgYXJ0aWNsZT8nKVxuICAgICAgICAgICAgLm9rKCdPaycpXG4gICAgICAgICAgICAuY2FuY2VsKCdDYW5jZWwnKTtcblxuICAgICAgICAkbWREaWFsb2cuc2hvdyhjb25maXJtKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgYmxvZ1NlcnZpY2UucmVtb3ZlUG9zdChpZCk7XG4gICAgICAgICAgICAkY3RybC5wb3N0cy5zcGxpY2UoJGluZGV4LCAxKTtcbiAgICAgICAgICAgICRtZERpYWxvZy5oaWRlKCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJG1kRGlhbG9nLmhpZGUoKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxufVxuIiwiYW5ndWxhclxuICAgIC5tb2R1bGUoJ2Jsb2cnKVxuXG4gICAgLmNvbXBvbmVudCgnYmxvZ0hlYWRlcicsIHtcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcuL2pzL2FwcC9oZWFkZXIvaGVhZGVyLnRtcGwuaHRtbCcsXG4gICAgICAgIGNvbnRyb2xsZXI6IGhlYWRlckNvbnRyb2xsZXJcbiAgICB9KTtcblxuZnVuY3Rpb24gaGVhZGVyQ29udHJvbGxlcigkc2NvcGUsIGF1dGhTZXJ2aWNlKSB7XG4gICAgbGV0ICRjdHJsID0gdGhpcztcbiAgICAkY3RybC5hdXRoU2VydmljZSA9IGF1dGhTZXJ2aWNlO1xuICAgICRjdHJsLmF1dGhEYXRhID0gJGN0cmwuYXV0aFNlcnZpY2UuYXV0aERhdGE7XG5cbiAgICAkY3RybC5sb2dvdXQgPSBsb2dvdXQ7XG5cblxuICAgIC8vICRzY29wZS4kd2F0Y2goJyRjdHJsLnN0YXR1cy5hdXRob3JpemF0aW9uJywgY2hlY2tBdXRoKTtcbiAgICAvL1xuICAgIC8vIGZ1bmN0aW9uIGNoZWNrQXV0aChuZXdWYWx1ZSwgb2xkVmFsdWUsIHNjb3BlKSB7XG4gICAgLy8gICAgIFwidXNlIHN0cmljdFwiO1xuICAgIC8vICAgICBpZiAobmV3VmFsdWUpIHtcbiAgICAvLyAgICAgICAgICRjdHJsLmVtYWlsID0gYXV0aFNlcnZpY2UuZ2V0UHJvZmlsZURhdGEoKS5lbWFpbDtcbiAgICAvLyAgICAgfVxuICAgIC8vIH1cblxuICAgIGZ1bmN0aW9uIGxvZ291dCAoKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICBhdXRoU2VydmljZS5sb2dvdXQoKTtcbiAgICB9XG59XG5cbiIsImFuZ3VsYXJcbiAgICAubW9kdWxlKCdhdXRoJylcbiAgICAuZGlyZWN0aXZlKCdjaGVja0VtYWlsJywgZnVuY3Rpb24gKCRodHRwLCAkcSkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICBsaW5rOiBsaW5rXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtLCBhdHRycywgbmdNb2RlbCkge1xuICAgICAgICAgICAgbmdNb2RlbC4kYXN5bmNWYWxpZGF0b3JzLmVtYWlsRXhpc3QgPSBlbWFpbEV4aXN0O1xuXG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGVtYWlsRXhpc3QobW9kZWxWYWx1ZSwgdmlld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnLy9sb2NhbGhvc3Q6MzAwMC9hcGkvYXV0aC9jaGVjay8nICsgdmlld1ZhbHVlKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHEucmVqZWN0KHJlc3BvbnNlLmRhdGEuc3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KSIsImFuZ3VsYXJcbiAgICAubW9kdWxlKCdhdXRoJylcbiAgICAuZGlyZWN0aXZlKCdwd2RDaGVjaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIHBhc3N3b3JkVmFsdWU6ICc9cHdkQ2hlY2snXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGluazogbGlua1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbGluayAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBuZ01vZGVsKSB7XG4gICAgICAgICAgICBuZ01vZGVsLiR2YWxpZGF0b3JzLnB3ZENoZWNrID0gcHdkQ2hlY2s7XG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3Bhc3N3b3JkVmFsdWUnLCB3YXRjaCk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHB3ZENoZWNrKG1vZGVsVmFsdWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbW9kZWxWYWx1ZSA9PT0gc2NvcGUucGFzc3dvcmRWYWx1ZTtcbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICBmdW5jdGlvbiB3YXRjaCgpIHtcbiAgICAgICAgICAgICAgICBuZ01vZGVsLiR2YWxpZGF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9KSIsImFuZ3VsYXJcbiAgICAubW9kdWxlKCdhdXRoJylcblxuICAgIC5zZXJ2aWNlKCdhdXRoU2VydmljZScsIGF1dGhTZXJ2aWNlKTtcblxuXG5mdW5jdGlvbiBhdXRoU2VydmljZSgkaHR0cCwgJHEsICRyb290U2NvcGUsIGxvY2FsU3RvcmFnZVNlcnZpY2UpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICB2YXIgX3NlbGYgPSB0aGlzO1xuXG4gICAgX3NlbGYuYXV0aERhdGEgPSB7XG4gICAgICAgIGF1dGhvcml6YXRpb246IGlzQXV0aCgpLFxuICAgICAgICBlbWFpbDogZ2V0UHJvZmlsZURhdGEoKSA/IGdldFByb2ZpbGVEYXRhKCkuZW1haWwgOiAnJyxcbiAgICB9O1xuXG4gICAgX3NlbGYucmVnaXN0ZXJVc2VyID0gcmVnaXN0ZXJVc2VyO1xuICAgIF9zZWxmLmF1dGhVc2VyID0gYXV0aFVzZXI7XG4gICAgX3NlbGYubG9nb3V0ID0gbG9nb3V0O1xuXG4gICAgX3NlbGYuc2V0UHJvZmlsZURhdGEgPSBzZXRQcm9maWxlRGF0YTtcbiAgICBfc2VsZi5nZXRQcm9maWxlRGF0YSA9IGdldFByb2ZpbGVEYXRhO1xuICAgIF9zZWxmLnJlbW92ZVByb2ZpbGVEYXRhID0gcmVtb3ZlUHJvZmlsZURhdGE7XG5cbiAgICByZXR1cm4gX3NlbGY7XG5cbiAgICBmdW5jdGlvbiBpc0F1dGgoKSB7XG4gICAgICAgIHJldHVybiBnZXRQcm9maWxlRGF0YSgpID8gdHJ1ZSA6IGZhbHNlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlZ2lzdGVyVXNlcihlbWFpbCwgcGFzc3dvcmQpIHtcbiAgICAgICAgdmFyIGRlZmZlcmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgJGh0dHBcbiAgICAgICAgICAgIC5wb3N0KFwiLy9sb2NhbGhvc3Q6MzAwMC9hcGkvYXV0aC9zaWdudXBcIiwge1xuICAgICAgICAgICAgICAgIGVtYWlsOiBlbWFpbCxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICAgICAgZGVmZmVyZWQucmVzb2x2ZShhdXRoVXNlcihlbWFpbCwgcGFzc3dvcmQpKTtcblxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgIGRlZmZlcmVkLnJlamVjdChlcnIuc3RhdHVzKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBkZWZmZXJlZC5wcm9taXNlO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBhdXRoVXNlcihlbWFpbCwgcGFzc3dvcmQpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBkZWZmZXJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICRodHRwXG4gICAgICAgICAgICAucG9zdChcIi8vbG9jYWxob3N0OjMwMDAvYXBpL2F1dGgvc2lnbmluXCIsIHtcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICB0b2tlbjogcmVzLmRhdGEudG9rZW4sXG4gICAgICAgICAgICAgICAgICAgIGVtYWlsOiByZXMuY29uZmlnLmRhdGEuZW1haWxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2V0UHJvZmlsZURhdGEoZGF0YSk7XG4gICAgICAgICAgICAgICAgX3NlbGYuYXV0aERhdGEuZW1haWwgPSBkYXRhLmVtYWlsO1xuICAgICAgICAgICAgICAgIF9zZWxmLmF1dGhEYXRhLmF1dGhvcml6YXRpb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgIGRlZmZlcmVkLnJlc29sdmUoKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICBkZWZmZXJlZC5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBkZWZmZXJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxvZ291dCgpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgICRodHRwXG4gICAgICAgICAgICAucG9zdChcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvYXV0aC9sb2dvdXRcIiwge30sIHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICdUb2tlbic6IGdldFByb2ZpbGVEYXRhKCkudG9rZW5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVQcm9maWxlRGF0YSgpO1xuICAgICAgICAgICAgICAgICAgICBfc2VsZi5hdXRoRGF0YS5hdXRob3JpemF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZXRQcm9maWxlRGF0YShkYXRhKSB7XG4gICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnYmxvZ0RhdGEnLCBkYXRhKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRQcm9maWxlRGF0YSgpIHtcbiAgICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCdibG9nRGF0YScpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlbW92ZVByb2ZpbGVEYXRhKCkge1xuICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlU2VydmljZS5yZW1vdmUoJ2Jsb2dEYXRhJyk7XG4gICAgfVxuXG59XG5cblxuIiwiYW5ndWxhclxuICAgIC5tb2R1bGUoJ2Jsb2cnKVxuICAgIC5zZXJ2aWNlKCdibG9nU2VydmljZScsIGJsb2dTZXJ2aWNlKTtcblxuZnVuY3Rpb24gYmxvZ1NlcnZpY2UoJGh0dHAsICRxLCBhdXRoU2VydmljZSkge1xuICAgIHZhciBfc2VsZiA9IHRoaXM7XG5cbiAgICBfc2VsZi5nZXRBbGxQb3N0cyA9IGdldEFsbFBvc3RzO1xuICAgIF9zZWxmLmdldFBvc3QgPSBnZXRQb3N0O1xuICAgIF9zZWxmLmFkZFBvc3QgPSBhZGRQb3N0O1xuICAgIF9zZWxmLnJlbW92ZVBvc3QgPSByZW1vdmVQb3N0O1xuXG4gICAgZnVuY3Rpb24gZ2V0QWxsUG9zdHMoKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgZGVmZmVyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgICAkaHR0cC5nZXQoJy8vbG9jYWxob3N0OjMwMDAvYXBpL2Jsb2cnKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcCkge1xuICAgICAgICAgICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICAgICAgICAgIGRlZmZlcmVkLnJlc29sdmUocmVzcCk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgZGVmZmVyZWQucmVqZWN0KGVycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGRlZmZlcmVkLnByb21pc2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0UG9zdCgpIHtcblxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFkZFBvc3QodGl0bGUsIHRleHQpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBkZWZmZXJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICRodHRwLnBvc3QoJy8vbG9jYWxob3N0OjMwMDAvYXBpL2Jsb2cnLHtcbiAgICAgICAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgICAgICAgIHRleHQ6IHRleHQsXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAnVG9rZW4nOiBhdXRoU2VydmljZS5nZXRQcm9maWxlRGF0YSgpLnRva2VuXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcbiAgICAgICAgICAgIGRlZmZlcmVkLnJlc29sdmUocmVzcCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGRlZmZlcmVkLnJlamVjdChlcnIpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGRlZmZlcmVkLnByb21pc2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVtb3ZlUG9zdChpZCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIGRlZmZlcmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgJGh0dHAuZGVsZXRlKCcvL2xvY2FsaG9zdDozMDAwL2FwaS9ibG9nLycraWQsIHtcbiAgICAgICAgICAgIGRhdGE6IHt9LFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICdUb2tlbic6IGF1dGhTZXJ2aWNlLmdldFByb2ZpbGVEYXRhKCkudG9rZW4sXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3ApO1xuICAgICAgICAgICAgZGVmZmVyZWQucmVzb2x2ZShyZXNwKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgZGVmZmVyZWQucmVqZWN0KGVycik7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZGVmZmVyZWQucHJvbWlzZTtcbiAgICB9XG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9

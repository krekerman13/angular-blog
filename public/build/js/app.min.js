//= ./app.module.js

/**
 * Created by krek on 01.08.17.
 */
angular
    .module('auth', []);

var app = angular
            .module('blog', ['ui.router', 'ngMessages', 'LocalStorageModule', 'ngMaterial', 'auth'])
            .run(function () {

            });
angular
    .module('blog')
    .config(function($stateProvider, $urlRouterProvider) {
        let mainState = {
                name: 'main',
                url: '/',
                component: 'blogList',
                resolve: {
                    posts: function (blogService) {
                        return blogService.getAllPosts()
                            .then(function (resp) {
                                if (resp.status === 200) {
                                    return resp.data;
                                } else {
                                    return resp.status;
                                }
                            });
                    }
                }
            },
            auth = {
                name: 'auth',
                url: '/auth',
                component: 'auth',
            },
            // blogState = {
            //     name: 'blog',
            //     url: '/blog/{itemId}',
            //     component: 'blogItem',
            //     resolve: {
            //         post: function(BlogService, $transition$) {
            //             console.log($transition$.params().itemId);
            //             return BlogService.getPost($transition$.params().itemId);
            //         }
            //     }
            // },
            state404 = {
                name: '404',
                url: '/404',
                templateUrl: '/404.html'
            };

        $urlRouterProvider.otherwise('/');
        $stateProvider.state(mainState);
        // $stateProvider.state(blogState);
        $stateProvider.state(state404);
        $stateProvider.state(auth);

    })
angular
    .module('blog')

    .component('blogHeader', {
        templateUrl: './js/app/header/header.tmpl.html',
        controller: headerController
    });

function headerController($scope, authService) {
    let $ctrl = this;
    $ctrl.authService = authService;
    $ctrl.authData = $ctrl.authService.authData;

    $ctrl.logout = logout;


    // $scope.$watch('$ctrl.status.authorization', checkAuth);
    //
    // function checkAuth(newValue, oldValue, scope) {
    //     "use strict";
    //     if (newValue) {
    //         $ctrl.email = authService.getProfileData().email;
    //     }
    // }

    function logout () {
        "use strict";
        authService.logout();
    }
}


angular
    .module('blog')
    .component('blogList', {
        templateUrl: './js/app/blog-list/blog-list.tmpl.html',
        controller: blogListController,
        bindings: {
            posts: '<'
        }
    });


function blogListController($scope, blogService, $mdDialog, authService, $state) {
    var $ctrl = this;


    $ctrl.showAddDialog = showAddDialog;
    $ctrl.$onInit = $onInit;


    function showAddDialog(env) {
        "use strict";
        $mdDialog.show({
            controller: addDialogController,
            templateUrl: './js/app/blog-list/directives/add-dialog.tmpl.html',
            targetEvent: env,
            clickOutsideToClose: true,
            locals: {
                posts: $ctrl.posts
            }

        }).then(function (result) {
            console.log(result);
        })

        function addDialogController($scope, $mdDialog, posts) {
            var $ctrl = $scope;
            $ctrl.close = close;
            $ctrl.addPost = addPost;
            $ctrl.posts = posts;

            function close() {
                "use strict";
                $mdDialog.hide();
            }

            function addPost() {
                blogService.addPost($ctrl.text, $ctrl.title)
                    .then(function (resp) {
                        console.log(resp);
                        $ctrl.posts.push(resp.data);
                        close();
                    }).catch(function (err) {
                    console.log(err);
                });
            }
        }
    }

    function $onInit() {
        "use strict";
        // blogService.getAllPosts().then(function(resp) {
        //     if(resp.status == 204) {
        //         console.log("No content");
        //     } else console.log(resp);
        // });
        //
        // console.log($ctrl.posts);
        console.log($ctrl.posts);
        $ctrl.authService = authService;
        $ctrl.status = $ctrl.authService.authData;
    }

}

angular
    .module('auth')

    .component('auth', {
        templateUrl: './js/app/auth/auth.tmpl.html',
        controller: authController,
    });

function authController($scope, authService, $state) {
    var $ctrl = this;

    $ctrl.$onInit = onInit;
    $ctrl.login = login;
    $ctrl.logout = logout;
    $ctrl.registration = registration;
    $ctrl.authMessage = '';
    $ctrl.regMessage = '';

    console.log($ctrl);

    function onInit() {
        "use strict";
        console.log(authService.status);
    }

    function login() {
        "use strict";
        var email = $ctrl.formData.authForm.email,
            password = $ctrl.formData.authForm.password;

        authService.authUser(email, password)
            .then(function() {
                $state.go('main');
            })
            .catch(function (err) {
                $ctrl.authMessage = err.data.message;
            });
    }

    function logout() {
        "use strict";
        authService.logout();
    }

    function registration() {
        "use strict";
        var email = $ctrl.formData.registrationForm.email,
            password = $ctrl.formData.registrationForm.password;

        console.log(authService.registerUser(email, password));
    }
}

angular
    .module('blog')
    .service('blogService', blogService);

function blogService($http, $q, authService) {
    var _self = this;

    _self.getAllPosts = getAllPosts;
    _self.getPost = getPost;
    _self.addPost = addPost;

    function getAllPosts() {
        "use strict";
        var deffered = $q.defer();
        $http.get('//localhost:3000/api/blog')
            .then(function(resp) {
                "use strict";
                deffered.resolve(resp);
            }, function (err) {
                deffered.reject(err);
            });
        return deffered.promise;
    }

    function getPost() {

    }

    function addPost(title, text) {
        "use strict";
        var deffered = $q.defer();
        $http.post('//localhost:3000/api/blog',{
            title: title,
            text: text,
        }, {
            headers: {
                'Token': authService.getProfileData().token
            }
        }).then(function (resp) {
            deffered.resolve(resp);
        }, function (err) {
            deffered.reject(err);
        });
        return deffered.promise;
    }
}
angular
    .module('auth')
    .directive('checkEmail', function ($http, $q) {
        "use strict";
        return {
            require: 'ngModel',
            restrict: 'A',
            link: link
        }

        function link(scope, elem, attrs, ngModel) {
            ngModel.$asyncValidators.emailExist = emailExist;


            function emailExist(modelValue, viewValue) {
                return $http.get('//localhost:3000/api/auth/check/' + viewValue)
                    .then(function (response) {
                        if (response.data.status == 200) {
                            return true;
                        } else {
                            $q.reject(response.data.status);
                        }
                    });
            }
        }
    })
angular
    .module('auth')
    .directive('pwdCheck', function() {
        "use strict";
        return {
            require: 'ngModel',
            restrict: 'A',
            scope: {
                passwordValue: '=pwdCheck'
            },
            link: link
        }

        function link (scope, element, attrs, ngModel) {
            ngModel.$validators.pwdCheck = pwdCheck;
            scope.$watch('passwordValue', watch);

            function pwdCheck(modelValue) {
                return modelValue === scope.passwordValue;
            }


            function watch() {
                ngModel.$validate();
            }
        }

    })
angular
    .module('auth')

    .service('authService', authService);


function authService($http, $q, $rootScope, localStorageService) {
    "use strict";
    var _self = this;

    _self.authData = {
        authorization: isAuth(),
        email: getProfileData() ? getProfileData().email : '',
    };

    _self.registerUser = registerUser;
    _self.authUser = authUser;
    _self.logout = logout;

    _self.setProfileData = setProfileData;
    _self.getProfileData = getProfileData;
    _self.removeProfileData = removeProfileData;

    return _self;

    function isAuth() {
        return getProfileData() ? true : false;
    }

    function registerUser(email, password) {
        var deffered = $q.defer();
        $http
            .post("//localhost:3000/api/auth/signup", {
                email: email,
                password: password
            })
            .then(function (res) {
                deffered.resolve(authUser(email, password));

            }, function (err) {
                deffered.reject(err.status);
            });

        return deffered.promise;
    };

    function authUser(email, password) {
        "use strict";
        var deffered = $q.defer();
        $http
            .post("//localhost:3000/api/auth/signin", {
                email: email,
                password: password
            })
            .then(function (res) {
                var data = {
                    token: res.data.token,
                    email: res.config.data.email
                }
                setProfileData(data);
                _self.authData.email = data.email;
                _self.authData.authorization = true;
                deffered.resolve();
            }, function (err) {
                deffered.reject(err);
            });

        return deffered.promise;
    }

    function logout() {
        "use strict";
        $http
            .post("http://localhost:3000/api/auth/logout", {}, {
                headers: {
                    'Token': getProfileData().token
                }
            })
            .then(function (res) {
                    removeProfileData();
                    _self.authData.authorization = false;
                },
                function (err) {
                    console.log(err);
                })
    }

    function setProfileData(data) {
        return localStorageService.set('blogData', data);
    }

    function getProfileData() {
        return localStorageService.get('blogData');
    }

    function removeProfileData() {
        return localStorageService.remove('blogData');
    }

}



//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFwcC5tb2R1bGUuanMiLCJhcHAucm91dGVzLmpzIiwiaGVhZGVyL2hlYWRlci5jb21wb25lbnQuanMiLCJibG9nLWxpc3QvYmxvZy1saXN0LmNvbXBvbmVudC5qcyIsImF1dGgvYXV0aC5jb21wb25lbnQuanMiLCJibG9nLWxpc3Qvc2VydmljZS9ibG9nLnNlcnZpY2UuanMiLCJhdXRoL2RpcmVjdGl2ZXMvY2hlY2stZW1haWwuZGlyZWN0aXZlLmpzIiwiYXV0aC9kaXJlY3RpdmVzL3Bhc3N3b3JkQ2hlY2suZGlyZWN0aXZlLmpzIiwiYXV0aC9zZXJ2aWNlcy9hdXRoLnNlcnZpY2UuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLz0gLi9hcHAubW9kdWxlLmpzXG4iLCIvKipcbiAqIENyZWF0ZWQgYnkga3JlayBvbiAwMS4wOC4xNy5cbiAqL1xuYW5ndWxhclxuICAgIC5tb2R1bGUoJ2F1dGgnLCBbXSk7XG5cbnZhciBhcHAgPSBhbmd1bGFyXG4gICAgICAgICAgICAubW9kdWxlKCdibG9nJywgWyd1aS5yb3V0ZXInLCAnbmdNZXNzYWdlcycsICdMb2NhbFN0b3JhZ2VNb2R1bGUnLCAnbmdNYXRlcmlhbCcsICdhdXRoJ10pXG4gICAgICAgICAgICAucnVuKGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgfSk7IiwiYW5ndWxhclxuICAgIC5tb2R1bGUoJ2Jsb2cnKVxuICAgIC5jb25maWcoZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xuICAgICAgICBsZXQgbWFpblN0YXRlID0ge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdtYWluJyxcbiAgICAgICAgICAgICAgICB1cmw6ICcvJyxcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdibG9nTGlzdCcsXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICBwb3N0czogZnVuY3Rpb24gKGJsb2dTZXJ2aWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYmxvZ1NlcnZpY2UuZ2V0QWxsUG9zdHMoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcC5kYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3Auc3RhdHVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYXV0aCA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnYXV0aCcsXG4gICAgICAgICAgICAgICAgdXJsOiAnL2F1dGgnLFxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ2F1dGgnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIGJsb2dTdGF0ZSA9IHtcbiAgICAgICAgICAgIC8vICAgICBuYW1lOiAnYmxvZycsXG4gICAgICAgICAgICAvLyAgICAgdXJsOiAnL2Jsb2cve2l0ZW1JZH0nLFxuICAgICAgICAgICAgLy8gICAgIGNvbXBvbmVudDogJ2Jsb2dJdGVtJyxcbiAgICAgICAgICAgIC8vICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAvLyAgICAgICAgIHBvc3Q6IGZ1bmN0aW9uKEJsb2dTZXJ2aWNlLCAkdHJhbnNpdGlvbiQpIHtcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKCR0cmFuc2l0aW9uJC5wYXJhbXMoKS5pdGVtSWQpO1xuICAgICAgICAgICAgLy8gICAgICAgICAgICAgcmV0dXJuIEJsb2dTZXJ2aWNlLmdldFBvc3QoJHRyYW5zaXRpb24kLnBhcmFtcygpLml0ZW1JZCk7XG4gICAgICAgICAgICAvLyAgICAgICAgIH1cbiAgICAgICAgICAgIC8vICAgICB9XG4gICAgICAgICAgICAvLyB9LFxuICAgICAgICAgICAgc3RhdGU0MDQgPSB7XG4gICAgICAgICAgICAgICAgbmFtZTogJzQwNCcsXG4gICAgICAgICAgICAgICAgdXJsOiAnLzQwNCcsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvNDA0Lmh0bWwnXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy8nKTtcbiAgICAgICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUobWFpblN0YXRlKTtcbiAgICAgICAgLy8gJHN0YXRlUHJvdmlkZXIuc3RhdGUoYmxvZ1N0YXRlKTtcbiAgICAgICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoc3RhdGU0MDQpO1xuICAgICAgICAkc3RhdGVQcm92aWRlci5zdGF0ZShhdXRoKTtcblxuICAgIH0pIiwiYW5ndWxhclxuICAgIC5tb2R1bGUoJ2Jsb2cnKVxuXG4gICAgLmNvbXBvbmVudCgnYmxvZ0hlYWRlcicsIHtcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcuL2pzL2FwcC9oZWFkZXIvaGVhZGVyLnRtcGwuaHRtbCcsXG4gICAgICAgIGNvbnRyb2xsZXI6IGhlYWRlckNvbnRyb2xsZXJcbiAgICB9KTtcblxuZnVuY3Rpb24gaGVhZGVyQ29udHJvbGxlcigkc2NvcGUsIGF1dGhTZXJ2aWNlKSB7XG4gICAgbGV0ICRjdHJsID0gdGhpcztcbiAgICAkY3RybC5hdXRoU2VydmljZSA9IGF1dGhTZXJ2aWNlO1xuICAgICRjdHJsLmF1dGhEYXRhID0gJGN0cmwuYXV0aFNlcnZpY2UuYXV0aERhdGE7XG5cbiAgICAkY3RybC5sb2dvdXQgPSBsb2dvdXQ7XG5cblxuICAgIC8vICRzY29wZS4kd2F0Y2goJyRjdHJsLnN0YXR1cy5hdXRob3JpemF0aW9uJywgY2hlY2tBdXRoKTtcbiAgICAvL1xuICAgIC8vIGZ1bmN0aW9uIGNoZWNrQXV0aChuZXdWYWx1ZSwgb2xkVmFsdWUsIHNjb3BlKSB7XG4gICAgLy8gICAgIFwidXNlIHN0cmljdFwiO1xuICAgIC8vICAgICBpZiAobmV3VmFsdWUpIHtcbiAgICAvLyAgICAgICAgICRjdHJsLmVtYWlsID0gYXV0aFNlcnZpY2UuZ2V0UHJvZmlsZURhdGEoKS5lbWFpbDtcbiAgICAvLyAgICAgfVxuICAgIC8vIH1cblxuICAgIGZ1bmN0aW9uIGxvZ291dCAoKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICBhdXRoU2VydmljZS5sb2dvdXQoKTtcbiAgICB9XG59XG5cbiIsImFuZ3VsYXJcbiAgICAubW9kdWxlKCdibG9nJylcbiAgICAuY29tcG9uZW50KCdibG9nTGlzdCcsIHtcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcuL2pzL2FwcC9ibG9nLWxpc3QvYmxvZy1saXN0LnRtcGwuaHRtbCcsXG4gICAgICAgIGNvbnRyb2xsZXI6IGJsb2dMaXN0Q29udHJvbGxlcixcbiAgICAgICAgYmluZGluZ3M6IHtcbiAgICAgICAgICAgIHBvc3RzOiAnPCdcbiAgICAgICAgfVxuICAgIH0pO1xuXG5cbmZ1bmN0aW9uIGJsb2dMaXN0Q29udHJvbGxlcigkc2NvcGUsIGJsb2dTZXJ2aWNlLCAkbWREaWFsb2csIGF1dGhTZXJ2aWNlLCAkc3RhdGUpIHtcbiAgICB2YXIgJGN0cmwgPSB0aGlzO1xuXG5cbiAgICAkY3RybC5zaG93QWRkRGlhbG9nID0gc2hvd0FkZERpYWxvZztcbiAgICAkY3RybC4kb25Jbml0ID0gJG9uSW5pdDtcblxuXG4gICAgZnVuY3Rpb24gc2hvd0FkZERpYWxvZyhlbnYpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgICRtZERpYWxvZy5zaG93KHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IGFkZERpYWxvZ0NvbnRyb2xsZXIsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy4vanMvYXBwL2Jsb2ctbGlzdC9kaXJlY3RpdmVzL2FkZC1kaWFsb2cudG1wbC5odG1sJyxcbiAgICAgICAgICAgIHRhcmdldEV2ZW50OiBlbnYsXG4gICAgICAgICAgICBjbGlja091dHNpZGVUb0Nsb3NlOiB0cnVlLFxuICAgICAgICAgICAgbG9jYWxzOiB7XG4gICAgICAgICAgICAgICAgcG9zdHM6ICRjdHJsLnBvc3RzXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xuICAgICAgICB9KVxuXG4gICAgICAgIGZ1bmN0aW9uIGFkZERpYWxvZ0NvbnRyb2xsZXIoJHNjb3BlLCAkbWREaWFsb2csIHBvc3RzKSB7XG4gICAgICAgICAgICB2YXIgJGN0cmwgPSAkc2NvcGU7XG4gICAgICAgICAgICAkY3RybC5jbG9zZSA9IGNsb3NlO1xuICAgICAgICAgICAgJGN0cmwuYWRkUG9zdCA9IGFkZFBvc3Q7XG4gICAgICAgICAgICAkY3RybC5wb3N0cyA9IHBvc3RzO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBjbG9zZSgpIHtcbiAgICAgICAgICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgICAgICAgICAkbWREaWFsb2cuaGlkZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBhZGRQb3N0KCkge1xuICAgICAgICAgICAgICAgIGJsb2dTZXJ2aWNlLmFkZFBvc3QoJGN0cmwudGV4dCwgJGN0cmwudGl0bGUpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRjdHJsLnBvc3RzLnB1c2gocmVzcC5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uICRvbkluaXQoKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICAvLyBibG9nU2VydmljZS5nZXRBbGxQb3N0cygpLnRoZW4oZnVuY3Rpb24ocmVzcCkge1xuICAgICAgICAvLyAgICAgaWYocmVzcC5zdGF0dXMgPT0gMjA0KSB7XG4gICAgICAgIC8vICAgICAgICAgY29uc29sZS5sb2coXCJObyBjb250ZW50XCIpO1xuICAgICAgICAvLyAgICAgfSBlbHNlIGNvbnNvbGUubG9nKHJlc3ApO1xuICAgICAgICAvLyB9KTtcbiAgICAgICAgLy9cbiAgICAgICAgLy8gY29uc29sZS5sb2coJGN0cmwucG9zdHMpO1xuICAgICAgICBjb25zb2xlLmxvZygkY3RybC5wb3N0cyk7XG4gICAgICAgICRjdHJsLmF1dGhTZXJ2aWNlID0gYXV0aFNlcnZpY2U7XG4gICAgICAgICRjdHJsLnN0YXR1cyA9ICRjdHJsLmF1dGhTZXJ2aWNlLmF1dGhEYXRhO1xuICAgIH1cblxufVxuIiwiYW5ndWxhclxuICAgIC5tb2R1bGUoJ2F1dGgnKVxuXG4gICAgLmNvbXBvbmVudCgnYXV0aCcsIHtcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcuL2pzL2FwcC9hdXRoL2F1dGgudG1wbC5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogYXV0aENvbnRyb2xsZXIsXG4gICAgfSk7XG5cbmZ1bmN0aW9uIGF1dGhDb250cm9sbGVyKCRzY29wZSwgYXV0aFNlcnZpY2UsICRzdGF0ZSkge1xuICAgIHZhciAkY3RybCA9IHRoaXM7XG5cbiAgICAkY3RybC4kb25Jbml0ID0gb25Jbml0O1xuICAgICRjdHJsLmxvZ2luID0gbG9naW47XG4gICAgJGN0cmwubG9nb3V0ID0gbG9nb3V0O1xuICAgICRjdHJsLnJlZ2lzdHJhdGlvbiA9IHJlZ2lzdHJhdGlvbjtcbiAgICAkY3RybC5hdXRoTWVzc2FnZSA9ICcnO1xuICAgICRjdHJsLnJlZ01lc3NhZ2UgPSAnJztcblxuICAgIGNvbnNvbGUubG9nKCRjdHJsKTtcblxuICAgIGZ1bmN0aW9uIG9uSW5pdCgpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIGNvbnNvbGUubG9nKGF1dGhTZXJ2aWNlLnN0YXR1cyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbG9naW4oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgZW1haWwgPSAkY3RybC5mb3JtRGF0YS5hdXRoRm9ybS5lbWFpbCxcbiAgICAgICAgICAgIHBhc3N3b3JkID0gJGN0cmwuZm9ybURhdGEuYXV0aEZvcm0ucGFzc3dvcmQ7XG5cbiAgICAgICAgYXV0aFNlcnZpY2UuYXV0aFVzZXIoZW1haWwsIHBhc3N3b3JkKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdtYWluJyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAkY3RybC5hdXRoTWVzc2FnZSA9IGVyci5kYXRhLm1lc3NhZ2U7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBsb2dvdXQoKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICBhdXRoU2VydmljZS5sb2dvdXQoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZWdpc3RyYXRpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICB2YXIgZW1haWwgPSAkY3RybC5mb3JtRGF0YS5yZWdpc3RyYXRpb25Gb3JtLmVtYWlsLFxuICAgICAgICAgICAgcGFzc3dvcmQgPSAkY3RybC5mb3JtRGF0YS5yZWdpc3RyYXRpb25Gb3JtLnBhc3N3b3JkO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKGF1dGhTZXJ2aWNlLnJlZ2lzdGVyVXNlcihlbWFpbCwgcGFzc3dvcmQpKTtcbiAgICB9XG59XG4iLCJhbmd1bGFyXG4gICAgLm1vZHVsZSgnYmxvZycpXG4gICAgLnNlcnZpY2UoJ2Jsb2dTZXJ2aWNlJywgYmxvZ1NlcnZpY2UpO1xuXG5mdW5jdGlvbiBibG9nU2VydmljZSgkaHR0cCwgJHEsIGF1dGhTZXJ2aWNlKSB7XG4gICAgdmFyIF9zZWxmID0gdGhpcztcblxuICAgIF9zZWxmLmdldEFsbFBvc3RzID0gZ2V0QWxsUG9zdHM7XG4gICAgX3NlbGYuZ2V0UG9zdCA9IGdldFBvc3Q7XG4gICAgX3NlbGYuYWRkUG9zdCA9IGFkZFBvc3Q7XG5cbiAgICBmdW5jdGlvbiBnZXRBbGxQb3N0cygpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBkZWZmZXJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICRodHRwLmdldCgnLy9sb2NhbGhvc3Q6MzAwMC9hcGkvYmxvZycpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwKSB7XG4gICAgICAgICAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgICAgICAgICAgZGVmZmVyZWQucmVzb2x2ZShyZXNwKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICBkZWZmZXJlZC5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZGVmZmVyZWQucHJvbWlzZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRQb3N0KCkge1xuXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYWRkUG9zdCh0aXRsZSwgdGV4dCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIGRlZmZlcmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgJGh0dHAucG9zdCgnLy9sb2NhbGhvc3Q6MzAwMC9hcGkvYmxvZycse1xuICAgICAgICAgICAgdGl0bGU6IHRpdGxlLFxuICAgICAgICAgICAgdGV4dDogdGV4dCxcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICdUb2tlbic6IGF1dGhTZXJ2aWNlLmdldFByb2ZpbGVEYXRhKCkudG9rZW5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcCkge1xuICAgICAgICAgICAgZGVmZmVyZWQucmVzb2x2ZShyZXNwKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgZGVmZmVyZWQucmVqZWN0KGVycik7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZGVmZmVyZWQucHJvbWlzZTtcbiAgICB9XG59IiwiYW5ndWxhclxuICAgIC5tb2R1bGUoJ2F1dGgnKVxuICAgIC5kaXJlY3RpdmUoJ2NoZWNrRW1haWwnLCBmdW5jdGlvbiAoJGh0dHAsICRxKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgIGxpbms6IGxpbmtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW0sIGF0dHJzLCBuZ01vZGVsKSB7XG4gICAgICAgICAgICBuZ01vZGVsLiRhc3luY1ZhbGlkYXRvcnMuZW1haWxFeGlzdCA9IGVtYWlsRXhpc3Q7XG5cblxuICAgICAgICAgICAgZnVuY3Rpb24gZW1haWxFeGlzdChtb2RlbFZhbHVlLCB2aWV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvL2xvY2FsaG9zdDozMDAwL2FwaS9hdXRoL2NoZWNrLycgKyB2aWV3VmFsdWUpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcS5yZWplY3QocmVzcG9uc2UuZGF0YS5zdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pIiwiYW5ndWxhclxuICAgIC5tb2R1bGUoJ2F1dGgnKVxuICAgIC5kaXJlY3RpdmUoJ3B3ZENoZWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgcGFzc3dvcmRWYWx1ZTogJz1wd2RDaGVjaydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsaW5rOiBsaW5rXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBsaW5rIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIG5nTW9kZWwpIHtcbiAgICAgICAgICAgIG5nTW9kZWwuJHZhbGlkYXRvcnMucHdkQ2hlY2sgPSBwd2RDaGVjaztcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgncGFzc3dvcmRWYWx1ZScsIHdhdGNoKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gcHdkQ2hlY2sobW9kZWxWYWx1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBtb2RlbFZhbHVlID09PSBzY29wZS5wYXNzd29yZFZhbHVlO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHdhdGNoKCkge1xuICAgICAgICAgICAgICAgIG5nTW9kZWwuJHZhbGlkYXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIH0pIiwiYW5ndWxhclxuICAgIC5tb2R1bGUoJ2F1dGgnKVxuXG4gICAgLnNlcnZpY2UoJ2F1dGhTZXJ2aWNlJywgYXV0aFNlcnZpY2UpO1xuXG5cbmZ1bmN0aW9uIGF1dGhTZXJ2aWNlKCRodHRwLCAkcSwgJHJvb3RTY29wZSwgbG9jYWxTdG9yYWdlU2VydmljZSkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIHZhciBfc2VsZiA9IHRoaXM7XG5cbiAgICBfc2VsZi5hdXRoRGF0YSA9IHtcbiAgICAgICAgYXV0aG9yaXphdGlvbjogaXNBdXRoKCksXG4gICAgICAgIGVtYWlsOiBnZXRQcm9maWxlRGF0YSgpID8gZ2V0UHJvZmlsZURhdGEoKS5lbWFpbCA6ICcnLFxuICAgIH07XG5cbiAgICBfc2VsZi5yZWdpc3RlclVzZXIgPSByZWdpc3RlclVzZXI7XG4gICAgX3NlbGYuYXV0aFVzZXIgPSBhdXRoVXNlcjtcbiAgICBfc2VsZi5sb2dvdXQgPSBsb2dvdXQ7XG5cbiAgICBfc2VsZi5zZXRQcm9maWxlRGF0YSA9IHNldFByb2ZpbGVEYXRhO1xuICAgIF9zZWxmLmdldFByb2ZpbGVEYXRhID0gZ2V0UHJvZmlsZURhdGE7XG4gICAgX3NlbGYucmVtb3ZlUHJvZmlsZURhdGEgPSByZW1vdmVQcm9maWxlRGF0YTtcblxuICAgIHJldHVybiBfc2VsZjtcblxuICAgIGZ1bmN0aW9uIGlzQXV0aCgpIHtcbiAgICAgICAgcmV0dXJuIGdldFByb2ZpbGVEYXRhKCkgPyB0cnVlIDogZmFsc2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVnaXN0ZXJVc2VyKGVtYWlsLCBwYXNzd29yZCkge1xuICAgICAgICB2YXIgZGVmZmVyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgICAkaHR0cFxuICAgICAgICAgICAgLnBvc3QoXCIvL2xvY2FsaG9zdDozMDAwL2FwaS9hdXRoL3NpZ251cFwiLCB7XG4gICAgICAgICAgICAgICAgZW1haWw6IGVtYWlsLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgICAgICBkZWZmZXJlZC5yZXNvbHZlKGF1dGhVc2VyKGVtYWlsLCBwYXNzd29yZCkpO1xuXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgZGVmZmVyZWQucmVqZWN0KGVyci5zdGF0dXMpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGRlZmZlcmVkLnByb21pc2U7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGF1dGhVc2VyKGVtYWlsLCBwYXNzd29yZCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIGRlZmZlcmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgJGh0dHBcbiAgICAgICAgICAgIC5wb3N0KFwiLy9sb2NhbGhvc3Q6MzAwMC9hcGkvYXV0aC9zaWduaW5cIiwge1xuICAgICAgICAgICAgICAgIGVtYWlsOiBlbWFpbCxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgIHRva2VuOiByZXMuZGF0YS50b2tlbixcbiAgICAgICAgICAgICAgICAgICAgZW1haWw6IHJlcy5jb25maWcuZGF0YS5lbWFpbFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzZXRQcm9maWxlRGF0YShkYXRhKTtcbiAgICAgICAgICAgICAgICBfc2VsZi5hdXRoRGF0YS5lbWFpbCA9IGRhdGEuZW1haWw7XG4gICAgICAgICAgICAgICAgX3NlbGYuYXV0aERhdGEuYXV0aG9yaXphdGlvbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgZGVmZmVyZWQucmVzb2x2ZSgpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgIGRlZmZlcmVkLnJlamVjdChlcnIpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGRlZmZlcmVkLnByb21pc2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbG9nb3V0KCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgJGh0dHBcbiAgICAgICAgICAgIC5wb3N0KFwiaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9hdXRoL2xvZ291dFwiLCB7fSwge1xuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgJ1Rva2VuJzogZ2V0UHJvZmlsZURhdGEoKS50b2tlblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZVByb2ZpbGVEYXRhKCk7XG4gICAgICAgICAgICAgICAgICAgIF9zZWxmLmF1dGhEYXRhLmF1dGhvcml6YXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNldFByb2ZpbGVEYXRhKGRhdGEpIHtcbiAgICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdibG9nRGF0YScsIGRhdGEpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldFByb2ZpbGVEYXRhKCkge1xuICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2Jsb2dEYXRhJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVtb3ZlUHJvZmlsZURhdGEoKSB7XG4gICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnJlbW92ZSgnYmxvZ0RhdGEnKTtcbiAgICB9XG5cbn1cblxuXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
